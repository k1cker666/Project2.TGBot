# Телеграм бот для изучения слов
Данный бот предоставляет функционал, с помощью которого вы сможете выучить иностранные слова, а также отследить свою статистику.
Бот доступен по ссылке https://t.me/vocab_trainer_bot

## Концепт
Бот предназначен для пользователей любого уровня подготовки.
### Уровни сложности слов:
- Начальный.
- Средний.
- Продвинутый.

### Типы уроков:
- Обычный урок.
- Повторение слов.
- Практика.

### Формат урока:
- В начале урока пользователю показывается список слов с их переводом.
- После данное сообщение скрывается под спойлер и появляется кнопка для удаления данного сообщения из чата.
- Затем бот поочередно показывает карточки с одним словом и четырьмя вариантами перевода.
- Если пользователь выбирает неправильный вариант, бот предлагает перевести слово еще раз.
- При правильном ответе бот переходит к следующему слову.
- В конце урока бот повторно выводит список слов с переводом.

### Дополнительные функции:
- Пользователь может просматривать свою статистику обучения.
- Пользователь имеет возможность изменить текущий уровень сложности слов.

## Функционал
Для доступа к функционалу необходимо пройти авторизацию в системе.

После успешной авторизации пользователю выводится 5 кнопок:
- Начать новый урок:
  
  Обычный урок, пользователь изучает слова, соответствующие его текущему уровню. Слово считается пройденным после одного правильного ответа в уроке.
- Повторить слова:
  
  Пользователь повторяет ранее изученные слова из обычных уроков. Слово переходит в статус выученного после трёх правильных ответов в данных уроках.
- Практика:

  Пользователь получает слова любого уровня для закрепления знаний. Верные ответы в данном типе урока не учитываются в статистику.
- Посмотреть статистику:

  Пользователю выводится количество пройденных и выученных слов. В сообщении также присутствует изображение двух соответствующих шкал, заполненных на процент слов от общего банка слов.
- Настройки

  Пользователю выводится меню для настройки аккаунта. На данном этапе изменить можно только уровень слов.

## Технологии
1. Poetry
  
   Все зависимости проекта контролируются с помощью Poetry.
2. Pre-commit
  
   Сконфигурирован pre-commit файл, который проверяет оформление написанного кода по стилистическим правилам PEP8.
   - Flake8: проверяет код на стилистические ошибки.
   - Black: форматтер, который проверяет весь код.
   - Isort: форматтер, который проверяет правильность написания импортов.
3. Pytest

   Тестирование методов и функций проекта проводилось с помощью Pytest.
5. Python-telegram-bot

   Вся логика бота реализована с помощью библиотеки Python-telegram-bot.
6. FastAPI

   На фреймворке FastAPI реализована API для авторизации пользователей в системе.
7. Psycopg

   С помощью Psycopg сервис бота обращается к базе данных PostgreSQL.
8. Redis-py

   Данные кэшируются в Redis. Для обращения к редису используется официальная библиотека.
9. SQLAlchemy

   С помощью SQLAlchemy сервис авторизации обращается к базе данных PostgreSQL.

## Хранилища
1. PostgreSQL

   В базе данных храним информацию о пользователях, слова для уроков, и прогресс пользователей.

   Сущности:
   - Users
     * user_id - номер пользователя внтури базы данных
     * tg_login - телеграм логин пользователя
     * login - логин пользователя в нашей системе
     * password - пароль пользователя в нашей система
     * words_in_lesson - количество слов в уроке
     * native_language - родной язык пользователя
     * language_to_learn - изучаемый язык пользователем
     * level - уровень слов пользователя
   - Words
     * word_id - номер слова внутри базы данных
     * language - язык слова
     * level - уровень слова
     * word - само слово
   - Words_in_progress
     * user_id - номер пользователя
     * word_id - номер слова
     * language - язык слова
     * number_of_repetitions - количество раз, которое мользователю еще нужно повторить данное слово
3. Redis

   В Redis храним uuid_token для авторизации пользователя, если она необходима, а также информация о уроке: статус урок активен/неактивен и данные для урока. Uuid_token хранится 30 минут, данные об уроке хранятся сутки.

## Авторизация

Сервис авторизации реализован на фреймворке FastAPI. Когда пользователь использует команду /start, бот проверяет авторизован ли пользователь, если нет, генерируется пара ключ-значение uuid_token:tg_username, которая помещается в Redis. Далее бот создает InLine-кнопку с ссылкой /authorization/?uuid_token=uuid_token на страницу для авторизации пользователя, сервис авторизации проверяет наличие uuid_token в Redis, если все в порядке и такой ключ существует, то открывается страница авторизации, иначе открывается страница информирующая об отказе в доступе. После успешной авторизации, пользователь может использовать функционал бота.

Сообщение, если uuid_token отсутствует в Redis:

![Alt](https://github.com/k1cker666/Project2.TGBot/raw/main/git_images/access_denied.png)

Аккаунты в системе не привязаны к tg_username, поэтому пользователь с одного телеграм аккаунта может использовать несколько аккаунтов. Чтобы выйти из аккаунта пользователь в любой момент может использовать команду /logout и пройти авторизацию заново.

Пример авторизации:

![Alt](https://github.com/k1cker666/Project2.TGBot/raw/main/git_images/auth.gif)

## DI

  Dependency Injection используются в двух сервисах:
  - tgbot - бизнес-логика телеграм бота
  - backend - сервис для авторизации пользователей
  В этих сервисах описаны собственные DependenciesBuilder, которые собирают все необходимые зависимости при запуске сервиса. Если зависимости нарушаются, например отсутствует подключение к Redis, сервис не начинает свою работу.

## Датасет слов

  Оригинальный датасет был взят с [гитхаба одного разработчика](https://github.com/nalgeon/words). Из датасета были убраны части речи, ссылки на произношение и объяснения слов, а также дубликаты слов. После с помощью библиотеки googletrans слова были переведены на русский язык и уже были убраны слова по дубликатам русских слов
